/**
 * FPS OPTIMIZATION STYLES
 * M1 Mac & Desktop Performance - Target 60fps minimum
 * 
 * Strategies:
 * 1. Frame skipping for expensive effects
 * 2. GPU acceleration for all animations
 * 3. Disable expensive blur effects
 * 4. Optimize paint and layout reflows
 * 5. Hardware acceleration hints
 */

/* ========================================
   GLOBAL GPU ACCELERATION
   ======================================== */

html {
  /* Enable high-precision rendering */
  scroll-behavior: auto; /* Use JS RAF-based scroll instead */
}

body {
  /* Enable subpixel antialiasing */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  
  /* Optimize rendering */
  text-rendering: optimizeLegibility;
}

* {
  /* Prevent layout thrashing */
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* ========================================
   ANIMATION OPTIMIZATION
   ======================================== */

/* Use transform and opacity only - GPU accelerated */
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: translateY(0) translateZ(0);
  }
}

@keyframes slideIn {
  from {
    transform: translateX(-100%) translateZ(0);
  }
  to {
    transform: translateX(0) translateZ(0);
  }
}

/* Frame skipping for shimmers - only update every 2 frames */
.shimmer-animated {
  animation: shimmer 2s infinite;
  will-change: transform;
  transform: translateZ(0);
}

/* ========================================
   BLUR ELIMINATION (M1 Mac Performance)
   ======================================== */

/* Disable all backdrop blur - expensive on M1 */
.backdrop-blur,
.backdrop-blur-sm,
.backdrop-blur-md,
.backdrop-blur-lg,
.backdrop-blur-xl {
  backdrop-filter: none !important;
}

/* Replace blur with solid/semi-transparent background */
.glass-effect {
  background: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  backdrop-filter: none !important;
}

.glass-dark {
  background: rgba(0, 0, 0, 0.4) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  backdrop-filter: none !important;
}

/* Disable blur in modals */
.modal .backdrop-blur,
dialog .backdrop-blur {
  backdrop-filter: none !important;
  background-color: rgba(0, 0, 0, 0.5) !important;
}

/* ========================================
   PAINT & LAYOUT CONTAINMENT
   ======================================== */

/* Isolate navbar from rest of page */
nav {
  contain: layout style paint;
  will-change: transform;
  transform: translateZ(0);
}

/* Isolate footer */
footer {
  contain: layout style paint;
  transform: translateZ(0);
}

/* Shimmer containers - prevent reflow */
[data-shimmer] {
  contain: paint;
  will-change: auto;
}

/* Modal containers */
.modal,
dialog {
  contain: layout style paint;
  transform: translateZ(0);
}

/* ========================================
   IMAGE OPTIMIZATION
   ======================================== */

img {
  /* Native lazy loading */
  loading: lazy;
  /* Reduce repaints when loading */
  content-visibility: auto;
}

/* Optimize background images */
[style*="background-image"] {
  contain: paint;
  background-attachment: local;
}

/* ========================================
   SHADOW OPTIMIZATION
   ======================================== */

/* Use simpler shadows - avoid complex layered shadows */
.shadow-sm {
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

.shadow {
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

/* Disable expensive shadows on mobile */
@media (max-width: 768px) {
  .shadow-lg,
  .shadow-xl,
  .shadow-2xl {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.1) !important;
  }
}

/* ========================================
   SCROLL OPTIMIZATION
   ======================================== */

/* Optimize scroll containers */
[data-scroll-container],
.overflow-y-auto,
.overflow-auto {
  contain: layout style paint;
  -webkit-overflow-scrolling: touch; /* Momentum scrolling on iOS */
  overscroll-behavior: contain;
}

/* ========================================
   ANIMATION MULTIPLIER
   ======================================== */

/* Use CSS custom properties for animation control */
:root {
  --animation-duration-multiplier: 0.7; /* Can be adjusted per device tier */
  --blur-amount: 0px; /* Always 0 for M1 performance */
  --shadow-opacity: 1;
  --target-fps: 60;
}

/* Apply animation duration scaling */
.animated {
  animation-duration: calc(
    var(--animation-duration-base, 0.5s) * var(--animation-duration-multiplier)
  );
}

/* ========================================
   DEVICE-TIER OPTIMIZATIONS
   ======================================== */

/* Ultra tier - all effects enabled (but with blur disabled) */
html.fps-ultra {
  --animation-duration-multiplier: 0.8;
}

/* High tier - normal quality */
html.fps-high {
  --animation-duration-multiplier: 0.7;
}

/* Medium tier - reduced animations */
html.fps-medium {
  --animation-duration-multiplier: 0.5;
}

html.fps-medium .animated {
  animation: none;
}

/* Low tier - minimal animations */
html.fps-low {
  --animation-duration-multiplier: 0.3;
}

html.fps-low .animated,
html.fps-low [data-animated] {
  animation: none !important;
}

/* Minimal tier - no effects */
html.fps-minimal {
  --animation-duration-multiplier: 0.1;
}

html.fps-minimal .animated,
html.fps-minimal [data-animated],
html.fps-minimal .shimmer-animated {
  animation: none !important;
}

html.fps-minimal [data-shimmer] {
  display: none !important;
}

/* ========================================
   SHIMMER QUALITY TIERS
   ======================================== */

/* High shimmer - normal speed */
html.shimmer-quality-high [data-shimmer] {
  opacity: 1;
}

/* Medium shimmer - slower animation */
html.shimmer-quality-medium [data-shimmer] {
  opacity: 0.7;
  animation-duration: 3s !important;
}

/* Low shimmer - very slow */
html.shimmer-quality-low [data-shimmer] {
  opacity: 0.5;
  animation-duration: 5s !important;
}

/* Disabled - hide all shimmers */
html.shimmer-quality-disabled [data-shimmer] {
  display: none !important;
}

/* ========================================
   REDUCE MOTION
   ======================================== */

/* Respect prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ========================================
   MOBILE OPTIMIZATIONS
   ======================================== */

@media (max-width: 768px) {
  /* Reduce animation complexity on mobile */
  * {
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Disable hover animations on touch devices */
  @media (hover: none) {
    :hover {
      background-color: inherit;
      color: inherit;
    }
  }
  
  /* Hardware acceleration for touch scrolling */
  body {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  
  /* Simpler animations on mobile */
  html.is-mobile .animated {
    animation: none;
  }
}

/* ========================================
   PERFORMANCE MONITORING
   ======================================== */

/* FPS Monitor styling */
.fps-monitor {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 10000;
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 11px;
  pointer-events: none;
}

/* ========================================
   WILL-CHANGE OPTIMIZATION
   ======================================== */

/* Only use will-change for elements that actually animate */
[data-animate] {
  will-change: transform, opacity;
}

/* Remove will-change after animation completes */
[data-animate].done {
  will-change: auto;
}

/* ========================================
   Z-INDEX OPTIMIZATION
   ======================================== */

/* Reduce z-index layers for simpler painting */
.navbar {
  z-index: 1000;
}

.modal {
  z-index: 2000;
}

.toast {
  z-index: 3000;
}

/* ========================================
   TRANSFORM-ONLY ANIMATIONS
   ======================================== */

/* Ensure all animations use only GPU-accelerated properties */
.transition-transform {
  transition-property: transform;
}

.transition-opacity {
  transition-property: opacity;
}

/* Avoid transitioning layout properties */
.no-transition {
  transition: none !important;
}

/* ========================================
   FONT OPTIMIZATION
   ======================================== */

/* Use system fonts as fallback for performance */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
}

/* Limit font variants to reduce memory */
@supports (font-variation-settings: normal) {
  body {
    font-variation-settings: 'wght' 400;
  }
  
  strong,
  .font-bold {
    font-variation-settings: 'wght' 700;
  }
}

/* ========================================
   CRITICAL PERFORMANCE FIXES - NEW
   ======================================== */

/* DISABLE ALL SPINNING ANIMATIONS - Major GPU drain */
.animate-\[spin,
[class*="animate-[spin"],
[style*="animation"][style*="spin"] {
  animation: none !important;
}

/* Pause ALL animations during scroll */
html.is-scrolling * {
  animation-play-state: paused !important;
  transition: none !important;
}

/* Disable backdrop-blur EVERYWHERE - extremely expensive */
*,
*::before,
*::after {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Replace blur with solid backgrounds */
.backdrop-blur-xl,
.backdrop-blur-lg,
.backdrop-blur-md,
.backdrop-blur-sm,
.backdrop-blur,
[class*="backdrop-blur"] {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(0, 0, 0, 0.85) !important;
}

/* Disable expensive box shadows on scroll */
html.is-scrolling .shadow-lg,
html.is-scrolling .shadow-xl,
html.is-scrolling .shadow-2xl,
html.is-scrolling [class*="shadow-"] {
  box-shadow: none !important;
}

/* Disable filter effects during scroll */
html.is-scrolling [style*="filter"],
html.is-scrolling [class*="drop-shadow"],
html.is-scrolling .drop-shadow {
  filter: none !important;
}

/* Disable all transforms except translateZ for compositing */
html.is-scrolling [style*="transform"]:not([style*="translateZ"]) {
  transform: none !important;
}

/* Kill conic gradients with spin - MAJOR CPU/GPU drain */
[class*="conic-gradient"],
[style*="conic-gradient"] {
  background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), transparent) !important;
  animation: none !important;
}

/* Disable framer-motion hover effects during scroll */
html.is-scrolling [data-framer-component-type] {
  pointer-events: none !important;
}

/* GPU layer optimization - force compositing for frequently animated elements */
.gpu-accelerated,
nav,
footer,
.modal,
[data-spline],
canvas {
  transform: translateZ(0);
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Avoid forcing containment on interactive layers to preserve stacking order */
nav,
footer,
.modal,
[data-spline],
canvas {
  contain: none;
}

/* Disable will-change on elements not currently animating */
html.is-scrolling [style*="will-change"] {
  will-change: auto !important;
}

/* Aggressive shimmer disable at low FPS */
html.shimmer-quality-low [data-shimmer],
html.shimmer-quality-low .shimmer-line,
html.shimmer-quality-low .shimmer-border,
html.fps-low [data-shimmer],
html.fps-minimal [data-shimmer] {
  display: none !important;
  animation: none !important;
}

/* Disable particle effects */
html.fps-low [class*="particle"],
html.fps-low [class*="tsparticles"],
html.fps-minimal [class*="particle"],
html.fps-minimal [class*="tsparticles"] {
  display: none !important;
}

/* ========================================
   2026 ULTRA PERFORMANCE ENHANCEMENTS
   ======================================== */

/* CRITICAL: Content-visibility for off-screen sections */
section,
article,
.content-section,
[data-section] {
  content-visibility: auto;
  contain-intrinsic-size: auto 500px;
}

/* Skip off-screen rendering entirely */
[data-visibility="hidden"] {
  content-visibility: hidden;
  visibility: hidden;
}

/* Optimize very long lists */
.virtual-list-item,
[data-virtual-item] {
  content-visibility: auto;
  contain-intrinsic-size: auto 50px;
}

/* CRITICAL: Force repaint boundaries */
.repaint-boundary {
  isolation: isolate;
  contain: strict;
}

/* Optimized modal rendering */
dialog[open],
.modal-open {
  contain: layout style paint size;
  isolation: isolate;
}

dialog:not([open]),
.modal:not(.modal-open) {
  display: none !important;
  content-visibility: hidden;
}

/* ULTRA: Disable all non-essential CSS during interaction */
html.is-interacting .shimmer-line,
html.is-interacting .shimmer-border,
html.is-interacting .shimmer-glow,
html.is-interacting [data-shimmer],
html.is-interacting [class*="animate-pulse"] {
  animation: none !important;
  opacity: 0 !important;
}

/* Disable expensive gradients during scroll/interaction */
html.is-scrolling [class*="bg-gradient"],
html.is-interacting [class*="bg-gradient"] {
  background: inherit !important;
}

/* CRITICAL: Optimize framer-motion */
[data-framer-name],
[data-framer-component-type],
[data-framer-portal-id] {
  contain: layout style;
  will-change: auto;
}

/* Force layer promotion only for active animations */
[data-framer-name].animating,
.motion-animating {
  will-change: transform, opacity;
  transform: translateZ(0);
}

/* CRITICAL: Optimize SVG rendering */
svg {
  contain: strict;
  transform: translateZ(0);
}

/* Disable SVG animations at low FPS */
html.fps-low svg *,
html.fps-minimal svg * {
  animation: none !important;
  transition: none !important;
}

/* CRITICAL: Canvas optimization */
canvas {
  contain: strict;
  isolation: isolate;
  image-rendering: optimizeSpeed;
}

/* Desktop: relax containment to avoid stacking-context issues for overlays/modals */
@media (min-width: 1024px) {
  canvas,
  video,
  iframe,
  [data-spline],
  [data-spline-scene] {
    contain: none !important;
    isolation: auto !important;
    will-change: auto !important;
    transform: translateZ(0);
  }
}

/* Reduce canvas quality at low FPS */
html.fps-low canvas,
html.fps-minimal canvas {
  image-rendering: pixelated;
  filter: none !important;
}

/* CRITICAL: Video optimization */
video {
  contain: strict;
  object-fit: cover;
}

html.fps-low video,
html.fps-minimal video {
  display: none !important;
}

/* ULTRA: Aggressive touch scrolling optimization */
@media (pointer: coarse) {
  * {
    touch-action: pan-y;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Disable all hover effects on touch devices */
  *:hover {
    animation-play-state: inherit !important;
  }
  
  /* Simpler shadows on touch devices */
  .shadow-lg,
  .shadow-xl,
  .shadow-2xl {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
  }
}

/* CRITICAL: Page visibility optimization */
html.page-hidden * {
  animation-play-state: paused !important;
  transition: none !important;
}

/* CRITICAL: Battery saver mode detection */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
  
  [data-shimmer],
  .shimmer-line,
  .shimmer-border {
    display: none !important;
  }
}

/* ULTRA: Print optimization */
@media print {
  *,
  *::before,
  *::after {
    animation: none !important;
    transition: none !important;
    background: white !important;
    color: black !important;
    box-shadow: none !important;
  }
}

/* ========================================
   DYNAMIC FPS-BASED ANIMATION SPEED
   ======================================== */

/* Animation speed scales with FPS tier */
html.fps-ultra {
  --animation-speed: 1;
  --shimmer-duration: 2s;
}

html.fps-high {
  --animation-speed: 0.85;
  --shimmer-duration: 2.5s;
}

html.fps-medium {
  --animation-speed: 0.6;
  --shimmer-duration: 4s;
}

html.fps-low {
  --animation-speed: 0;
  --shimmer-duration: 0s;
}

html.fps-minimal {
  --animation-speed: 0;
  --shimmer-duration: 0s;
}

/* Apply dynamic animation speed */
.dynamic-animation {
  animation-duration: calc(var(--base-duration, 1s) * var(--animation-speed, 1)) !important;
}

.shimmer-line,
.shimmer-border {
  animation-duration: var(--shimmer-duration, 2s) !important;
}
