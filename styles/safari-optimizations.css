/**
 * Safari-Specific Optimizations CSS
 * 
 * This file contains CSS fixes specifically for Safari browsers.
 * It works in conjunction with the safariOptimizations.ts JavaScript module.
 * 
 * Classes applied by JavaScript:
 * - .is-safari: All Safari browsers
 * - .is-mobile-safari: Safari on iPhone/iPad
 * - .is-ios-safari: iOS Safari specifically
 * - .safari-legacy: Safari < 15
 * - .safari-modern: Safari >= 16
 */

/* ================================================================
   SAFARI BASE FIXES
   ================================================================ */

/* Safari font rendering */
html.is-safari {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* Safari needs explicit GPU layer hints for animations */
html.is-safari .animate-pulse,
html.is-safari .animate-spin,
html.is-safari .animate-bounce,
html.is-safari .animate-ping {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Safari backdrop-filter performance fix */
html.is-safari .backdrop-blur-2xl {
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
}

html.is-safari .backdrop-blur-xl {
  -webkit-backdrop-filter: blur(16px);
  backdrop-filter: blur(16px);
}

html.is-safari .backdrop-blur-lg {
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

/* Safari gradient fix */
html.is-safari .bg-gradient-to-r,
html.is-safari .bg-gradient-to-l,
html.is-safari .bg-gradient-to-t,
html.is-safari .bg-gradient-to-b {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* ================================================================
   SAFARI MOBILE FIXES
   ================================================================ */

/* iOS Safari viewport height fix */
html.is-ios-safari {
  min-height: -webkit-fill-available;
  min-height: 100dvh;
}

html.is-ios-safari body {
  min-height: -webkit-fill-available;
  min-height: 100dvh;
}

/* Mobile Safari scrolling */
html.is-mobile-safari body {
  -webkit-overflow-scrolling: touch;
  overflow-y: auto;
}

html.is-mobile-safari main {
  -webkit-overflow-scrolling: touch;
  overflow-y: auto;
}

/* iOS Safari safe area support */
html.is-ios-safari main {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* Safari position: fixed issues */
html.is-ios-safari .fixed {
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
}

/* Safari touch-action fix */
html.is-mobile-safari [data-allow-scroll] {
  touch-action: pan-y !important;
  -webkit-touch-callout: none;
}

/* Safari tap highlight removal */
html.is-mobile-safari button,
html.is-mobile-safari a,
html.is-mobile-safari [role="button"] {
  -webkit-tap-highlight-color: transparent;
}

/* ================================================================
   SAFARI CANVAS & WEBGL FIXES
   ================================================================ */

/* Safari canvas rendering */
html.is-safari canvas {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* Spline canvas optimization */
html.is-safari .spline-container canvas,
html.is-safari [data-spline] canvas {
  image-rendering: auto;
  image-rendering: -webkit-optimize-contrast;
}

/* ================================================================
   SAFARI ANIMATION FIXES
   ================================================================ */

/* Safari shimmer animations with prefixes */
html.is-safari .shimmer-line {
  -webkit-animation: unified-shimmer-ltr 3s linear infinite;
  animation: unified-shimmer-ltr 3s linear infinite;
  -webkit-will-change: transform;
  will-change: transform;
}

html.is-safari .shimmer-spin {
  -webkit-animation: unified-spin 4s linear infinite;
  animation: unified-spin 4s linear infinite;
  -webkit-will-change: transform;
  will-change: transform;
}

html.is-safari .shimmer-pulse {
  -webkit-animation: unified-pulse 3s ease-in-out infinite;
  animation: unified-pulse 3s ease-in-out infinite;
  -webkit-will-change: opacity;
  will-change: opacity;
}

/* Safari z-index stacking context fix */
html.is-safari .isolate {
  isolation: isolate;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* ================================================================
   SAFARI LEGACY FIXES (< 15)
   ================================================================ */

/* Legacy Safari backdrop-filter fallback */
html.safari-legacy .backdrop-blur-2xl,
html.safari-legacy .backdrop-blur-xl,
html.safari-legacy .backdrop-blur-lg {
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
  background-color: rgba(0, 0, 0, 0.85);
}

/* Legacy Safari CSS contain fallback */
html.safari-legacy [style*="contain: strict"],
html.safari-legacy [style*="contain:strict"] {
  contain: layout style;
}

/* Legacy Safari flexbox gap fallback */
@supports not (gap: 1rem) {
  html.safari-legacy .gap-1 > * + * { margin-left: 0.25rem; }
  html.safari-legacy .gap-2 > * + * { margin-left: 0.5rem; }
  html.safari-legacy .gap-3 > * + * { margin-left: 0.75rem; }
  html.safari-legacy .gap-4 > * + * { margin-left: 1rem; }
}

/* ================================================================
   SAFARI PERFORMANCE OPTIMIZATIONS
   ================================================================ */

/* Reduce animations on Safari when memory is constrained */
html.is-safari.reduce-animations .shimmer-line,
html.is-safari.reduce-animations .shimmer-spin,
html.is-safari.reduce-animations .shimmer-pulse,
html.is-safari.reduce-animations .shimmer-glow {
  -webkit-animation: none !important;
  animation: none !important;
}

/* Safari GPU compositing hints */
html.is-safari .gpu-accelerated {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000;
  perspective: 1000;
}

/* Safari text-shadow performance */
html.is-safari .drop-shadow-lg,
html.is-safari .drop-shadow-xl,
html.is-safari .drop-shadow-2xl {
  -webkit-filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));
  filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));
}

/* ================================================================
   SAFARI SCROLLBAR STYLING
   ================================================================ */

html.is-safari ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

html.is-safari ::-webkit-scrollbar-track {
  background: transparent;
}

html.is-safari ::-webkit-scrollbar-thumb {
  background: rgba(59, 130, 246, 0.3);
  border-radius: 4px;
}

html.is-safari ::-webkit-scrollbar-thumb:hover {
  background: rgba(59, 130, 246, 0.5);
}

/* Hide scrollbars on mobile Safari */
html.is-mobile-safari ::-webkit-scrollbar {
  display: none;
}

/* ================================================================
   SAFARI FORM FIXES
   ================================================================ */

/* Safari input styling */
html.is-safari input,
html.is-safari textarea,
html.is-safari select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* Safari autofill background fix */
html.is-safari input:-webkit-autofill {
  -webkit-box-shadow: 0 0 0 1000px #000 inset !important;
  -webkit-text-fill-color: #fff !important;
}

/* ================================================================
   SAFARI MEDIA QUERY OVERRIDES
   ================================================================ */

/* Safari on retina displays */
@media screen and (-webkit-min-device-pixel-ratio: 2) {
  html.is-safari .text-sharp {
    -webkit-font-smoothing: subpixel-antialiased;
  }
}

/* Safari in dark mode */
@media (prefers-color-scheme: dark) {
  html.is-safari body {
    color-scheme: dark;
  }
}
