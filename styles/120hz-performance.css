/* ============================================================================
   120Hz ULTRA PERFORMANCE - Luxury Dashboard Optimization
   ============================================================================
   
   This CSS file provides critical performance optimizations for 120Hz displays
   on Apple Silicon devices. It follows the "Glass Engine" rule and ensures
   smooth scrolling and GPU compositing.
   
   UPDATED 2026: Fixed mouse wheel scrolling on big displays
   ============================================================================ */

/* ============================================================================
   CRITICAL: SCROLL FIX - Make page scrollable at 120Hz
   FIXED: Changed overscroll-behavior from 'none' to 'auto' to enable scrolling
   FIXED 2026: Better mouse wheel support for big displays (1440px+)
   ============================================================================ */
html {
  /* Native scrolling - do NOT use scroll-behavior: smooth, it causes jank with mouse wheel */
  overflow-y: auto !important;
  overflow-x: hidden;
  /* FIXED: Changed from 'none' to 'auto' - 'none' was blocking scroll on some devices */
  overscroll-behavior: auto;
  /* Touch scrolling for iOS */
  -webkit-overflow-scrolling: touch;
  /* CRITICAL: Use 'auto' for instant mouse wheel response on big displays */
  scroll-behavior: auto;
}

body {
  overflow-y: visible;
  overflow-x: hidden;
  /* FIXED: Changed from 'none' to 'contain' - only prevent overscroll bounce */
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
  /* Prevent body from being fixed */
  position: relative !important;
  height: auto !important;
  min-height: 100vh;
}

/* ============================================================================
   BIG DISPLAY OPTIMIZATIONS (1440px+) - Mouse wheel scrolling fixes
   ============================================================================ */
@media (min-width: 1440px) {
  html {
    /* Ensure instant scroll response on big displays */
    scroll-behavior: auto !important;
  }
  
  /* Disable scroll-snap for mouse users on big displays */
  html:not(.touch-device) body,
  html:not(.touch-device) main {
    scroll-snap-type: none !important;
  }
  
  html:not(.touch-device) section {
    scroll-snap-align: none !important;
    scroll-snap-stop: normal !important;
  }
}

/* Override Lenis if it's blocking scroll */
html.lenis,
html.lenis-smooth,
html.has-scroll-smooth {
  overflow: auto !important;
}

html.lenis body,
html.lenis-smooth body,
html.has-scroll-smooth body {
  overflow: visible !important;
}

/* ============================================================================
   CSS CONTAINMENT - Critical for 120Hz Performance
   ============================================================================ */

/* Main scrollable containers */
main,
[data-allow-scroll],
[data-scrollable] {
  contain: layout style;
  touch-action: pan-y pan-x;
  overscroll-behavior: contain;
}

/* Sections that don't affect siblings */
section {
  contain: layout style;
}

/* Cards and contained UI elements */
.card,
[data-card],
.modal-content {
  contain: layout paint style;
}

/* Strict containment for heavy components */
.spline-container,
[data-spline-scene],
canvas {
  contain: strict;
  touch-action: pan-y;
}

/* ============================================================================
   GLASS ENGINE RULE - GPU Compositing for Glassmorphism
   ============================================================================ */

/* All translucent/blur elements MUST have GPU layer */
.backdrop-blur-sm,
.backdrop-blur,
.backdrop-blur-md,
.backdrop-blur-lg,
.backdrop-blur-xl,
.backdrop-blur-2xl,
.backdrop-blur-3xl,
[class*="backdrop-blur"] {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  isolation: isolate;
  /* Optimize blur compositing - standard + prefixed */
  backdrop-filter: blur(var(--tw-backdrop-blur));
  -webkit-backdrop-filter: blur(var(--tw-backdrop-blur));
  will-change: auto; /* Only promote when needed */
}

/* Glass surfaces - optimized for 120Hz */
.glass-surface,
.glass-panel,
[data-glass] {
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  /* Use hardware-accelerated blur */
  -webkit-backdrop-filter: blur(16px) saturate(180%);
  backdrop-filter: blur(16px) saturate(180%);
  /* Prevent paint thrashing */
  contain: paint layout;
}

/* ============================================================================
   ANIMATION PERFORMANCE - Only animate compositor properties
   ============================================================================ */

/* Allowed animation properties (GPU accelerated) */
.animate-gpu {
  transform: translateZ(0);
  will-change: transform, opacity;
}

/* Force GPU for common animations */
@keyframes gpu-pulse {
  0%, 100% { opacity: 1; transform: translateZ(0) scale(1); }
  50% { opacity: 0.7; transform: translateZ(0) scale(1.02); }
}

@keyframes gpu-spin {
  from { transform: translateZ(0) rotate(0deg); }
  to { transform: translateZ(0) rotate(360deg); }
}

@keyframes gpu-bounce {
  0%, 100% { transform: translateZ(0) translateY(0); }
  50% { transform: translateZ(0) translateY(-10px); }
}

/* Replace default animations with GPU versions */
.animate-pulse-gpu { animation: gpu-pulse 2s ease-in-out infinite; }
.animate-spin-gpu { animation: gpu-spin 1s linear infinite; }
.animate-bounce-gpu { animation: gpu-bounce 1s ease-in-out infinite; }

/* ============================================================================
   TICKER OPTIMIZATION - CSS-only marquee for 120Hz
   ============================================================================ */

.ticker-container {
  contain: strict;
  overflow: hidden;
  transform: translateZ(0);
}

.ticker-track {
  display: flex;
  animation: ticker-scroll 40s linear infinite;
  transform: translateZ(0);
  will-change: transform;
}

@keyframes ticker-scroll {
  0% { transform: translate3d(0, 0, 0); }
  100% { transform: translate3d(-50%, 0, 0); }
}

/* Pause on hover without re-render */
.ticker-container:hover .ticker-track {
  animation-play-state: paused;
}

/* ============================================================================
   FIXED ELEMENTS - Navbar, Footer, Modals
   ============================================================================ */

/* Fixed elements need GPU layer to prevent scroll jank */
nav[class*="fixed"],
.fixed-header,
.fixed-footer,
[class*="fixed"][class*="bottom"],
[class*="fixed"][class*="top"] {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  contain: layout paint;
}

/* Modal backdrops */
.modal-backdrop,
[data-backdrop],
.overlay {
  transform: translateZ(0);
  contain: paint;
}

/* ============================================================================
   SPLINE & CANVAS - 120Hz WebGL Optimization  
   ============================================================================ */

canvas {
  transform: translateZ(0);
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  /* Allow scroll passthrough */
  touch-action: pan-y;
  pointer-events: auto;
}

/* Spline scene wrapper - isolate from UI */
.spline-wrapper,
[data-spline],
[data-spline-scene] {
  contain: strict;
  isolation: isolate;
  transform: translate3d(0, 0, 0);
  /* Prevent Spline from blocking scroll */
  touch-action: pan-y;
}

/* ============================================================================
   REDUCE MOTION - Respect user preference
   ============================================================================ */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .ticker-track {
    animation: none !important;
  }
}

/* ============================================================================
   120Hz DISPLAY SPECIFIC OPTIMIZATIONS
   ============================================================================ */

/* ProMotion and high-refresh displays */
@media screen and (min-resolution: 2dppx) {
  .display-120hz,
  .fps-120 {
    /* Smoother curves for 120Hz */
    --spring-smooth: cubic-bezier(0.2, 0, 0.2, 1);
    --transition-fast: 0.1s;
    --transition-normal: 0.2s;
  }
  
  /* Faster transitions look better at 120Hz */
  .display-120hz .transition-all {
    transition-duration: var(--transition-fast);
  }
}

/* ============================================================================
   DESKTOP PERFORMANCE OPTIMIZATIONS
   For Apple Silicon M1+ Macs and high-performance Windows/Linux desktops
   ============================================================================ */

/* Base desktop optimizations */
@media (min-width: 769px) and (hover: hover) {
  /* Force GPU compositing on interactive elements */
  .desktop-optimized button,
  .desktop-optimized a,
  .desktop-optimized [role="button"],
  .high-performance button,
  .high-performance a,
  .high-performance [role="button"] {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    will-change: transform;
  }
  
  /* Optimize font rendering for desktop */
  .desktop-optimized,
  .high-performance {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
  
  /* Desktop hover states */
  .desktop-optimized .hover-lift:hover,
  .high-performance .hover-lift:hover {
    transform: translateY(-4px) translateZ(0);
    transition: transform 0.12s cubic-bezier(0.16, 1, 0.3, 1);
  }
}

/* Apple Silicon Mac specific optimizations */
.apple-silicon {
  /* Ultra-smooth animations for M1/M2/M3/M4 GPUs */
  --animation-smoothing: 0.4;
  --spring-stiff: cubic-bezier(0.45, 1.85, 0.35, 0.85);
  --spring-smooth: cubic-bezier(0.14, 1, 0.28, 1);
}

.apple-silicon * {
  /* Enable all visual effects on Apple Silicon */
  -webkit-font-smoothing: antialiased;
}

.apple-silicon canvas {
  /* Apple GPU WebGL optimizations */
  transform: translate3d(0, 0, 0);
  image-rendering: -webkit-optimize-contrast;
}

/* Discrete GPU optimizations (NVIDIA, AMD) */
.discrete-gpu {
  --blur-enabled: 1;
  --shadows-enabled: 1;
  --glow-enabled: 1;
  --particles-enabled: 1;
}

.discrete-gpu canvas {
  /* Full quality for discrete GPUs */
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* High-performance desktop mode - maximum quality */
.high-performance.perf-ultra {
  --blur-amount: 24px;
  --shadow-opacity: 1;
  --glow-intensity: 1;
  --animation-quality: high;
}

.high-performance.perf-ultra .backdrop-blur-lg {
  -webkit-backdrop-filter: blur(24px) saturate(180%);
  backdrop-filter: blur(24px) saturate(180%);
}

.high-performance.perf-ultra canvas,
.high-performance.perf-ultra [data-spline] {
  /* Maximum GPU utilization for 3D scenes */
  contain: strict;
  will-change: contents;
}

/* ============================================================================
   LAYER MANAGEMENT - Prevent layer explosion
   ============================================================================ */

/* Only promote actively animating elements */
.animating {
  will-change: transform, opacity;
}

/* Remove will-change after animation ends */
.animation-complete {
  will-change: auto;
}

/* Limit backdrop-blur on mobile for performance */
@media (max-width: 768px) {
  .backdrop-blur-xl,
  .backdrop-blur-2xl,
  .backdrop-blur-3xl {
    -webkit-backdrop-filter: blur(12px);
    backdrop-filter: blur(12px);
  }
}

/* ============================================================================
   SCROLL SNAP - Optional smooth scroll sections
   ============================================================================ */

.scroll-snap-container {
  scroll-snap-type: y proximity;
  overscroll-behavior-y: contain;
}

.scroll-snap-section {
  scroll-snap-align: start;
}

/* ============================================================================
   DESKTOP LITE MODE - User-controlled performance optimization
   ============================================================================
   
   When enabled via the lite mode toggle, this disables heavy render effects
   (shadows, glows, backdrop-blur) while KEEPING ANIMATIONS working.
   
   This allows users with older hardware or who prefer cleaner visuals to
   still enjoy the site with smooth animations.
   ============================================================================ */

/* Desktop Lite Mode - Disable heavy effects */
html.desktop-lite-mode {
  /* CSS variables for lite mode */
  --lite-mode: 1;
  --blur-enabled: 0;
  --shadows-enabled: 0;
  --glow-enabled: 0;
}

/* Disable backdrop blur in lite mode */
html.desktop-lite-mode .backdrop-blur-sm,
html.desktop-lite-mode .backdrop-blur,
html.desktop-lite-mode .backdrop-blur-md,
html.desktop-lite-mode .backdrop-blur-lg,
html.desktop-lite-mode .backdrop-blur-xl,
html.desktop-lite-mode .backdrop-blur-2xl,
html.desktop-lite-mode .backdrop-blur-3xl,
html.desktop-lite-mode [class*="backdrop-blur"] {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  /* Replace blur with solid semi-transparent background */
  background-color: rgba(0, 0, 0, 0.85) !important;
}

/* Disable heavy box shadows in lite mode */
html.desktop-lite-mode [style*="box-shadow"],
html.desktop-lite-mode .shadow-lg,
html.desktop-lite-mode .shadow-xl,
html.desktop-lite-mode .shadow-2xl,
html.desktop-lite-mode [class*="shadow-"] {
  box-shadow: none !important;
}

/* Disable text shadows / glows in lite mode */
html.desktop-lite-mode [style*="text-shadow"] {
  text-shadow: none !important;
}

/* Disable filter effects (drop-shadow, blur) in lite mode */
html.desktop-lite-mode [style*="filter"]:not(img):not(video) {
  filter: none !important;
}

/* Glass surfaces in lite mode - use solid background */
html.desktop-lite-mode .glass-surface,
html.desktop-lite-mode .glass-panel,
html.desktop-lite-mode [data-glass] {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  background-color: rgba(10, 10, 15, 0.95) !important;
  border: 1px solid rgba(59, 130, 246, 0.3) !important;
}

/* Keep borders visible for visual clarity in lite mode */
html.desktop-lite-mode .border-blue-500\/50,
html.desktop-lite-mode [class*="border-blue"] {
  border-color: rgba(59, 130, 246, 0.5) !important;
}

/* Reduce animation complexity in lite mode (optional - keep enabled for smooth UX) */
/* Note: We're NOT disabling animations, just reducing some complexity */
html.desktop-lite-mode .animate-pulse {
  animation-duration: 2s !important;
}

/* Keep core animations working - these are lightweight */
html.desktop-lite-mode .animate-spin,
html.desktop-lite-mode .animate-bounce,
html.desktop-lite-mode .animate-ping {
  /* Keep these running - they're GPU accelerated */
}

/* Spline/WebGL scenes - keep running but reduce quality hint */
html.desktop-lite-mode canvas,
html.desktop-lite-mode [data-spline-scene] {
  /* Scenes stay enabled - this is just a hint */
  image-rendering: optimizeSpeed;
}

/* Disable glow effects on buttons and interactive elements */
html.desktop-lite-mode button:hover,
html.desktop-lite-mode a:hover {
  box-shadow: none !important;
}

/* Lite mode indicator styling */
html.desktop-lite-mode [data-lite-indicator] {
  display: flex !important;
}

/* Performance boost: reduce repaints */
html.desktop-lite-mode * {
  /* Hint to browser to optimize */
  -webkit-font-smoothing: subpixel-antialiased;
}
