<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spline Debug - BULLMONEY</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #0ff;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .section {
            background: #111;
            border: 1px solid #333;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .label {
            color: #ff0;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .value {
            color: #0f0;
            margin-left: 10px;
        }
        .error {
            color: #f00;
        }
        .success {
            color: #0f0;
        }
        .warning {
            color: #fa0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            border-radius: 4px;
            font-weight: bold;
        }
        button:active {
            opacity: 0.7;
        }
        .btn-danger {
            background: #f00;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç SPLINE DEBUG TOOL</h1>

        <div class="section">
            <div class="label">Device Detection:</div>
            <div id="device-info"></div>
        </div>

        <div class="section">
            <div class="label">LocalStorage Values:</div>
            <div id="storage-info"></div>
        </div>

        <div class="section">
            <div class="label">Spline Status:</div>
            <div id="spline-status"></div>
        </div>

        <div class="section">
            <div class="label">Actions:</div>
            <button onclick="enableSplines()">‚úÖ FORCE ENABLE SPLINES</button>
            <button onclick="disableSplines()" class="btn-danger">‚ùå DISABLE SPLINES</button>
            <button onclick="clearAll()" class="btn-danger">üóëÔ∏è CLEAR ALL STORAGE</button>
            <button onclick="location.reload()">üîÑ REFRESH</button>
        </div>

        <div class="section">
            <div class="label">Console Output:</div>
            <div id="console-output" style="height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Override console.log to show in UI
        const consoleDiv = document.getElementById('console-output');
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog(...args);
            const line = document.createElement('div');
            line.textContent = args.join(' ');
            line.style.marginBottom = '5px';
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        function detectDevice() {
            const ua = navigator.userAgent || '';
            const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
            const isWebView = /Instagram|FBAN|FBAV|Line|TikTok|Twitter/i.test(ua);
            const memory = (navigator.deviceMemory || 4);
            const cores = (navigator.hardwareConcurrency || 4);
            const connection = (navigator.connection || navigator.mozConnection || navigator.webkitConnection);
            const effectiveType = connection?.effectiveType || '4g';

            // WebGL test
            const canvas = document.createElement('canvas');
            const hasWebGL = !!(canvas.getContext('webgl') || canvas.getContext('webgl2'));

            const info = `
                <div class="value">üì± Mobile: ${isMobile ? 'YES' : 'NO'}</div>
                <div class="value">üåê WebView: ${isWebView ? 'YES' : 'NO'}</div>
                <div class="value">üíæ RAM: ${memory}GB</div>
                <div class="value">üîß CPU Cores: ${cores}</div>
                <div class="value">üì∂ Connection: ${effectiveType}</div>
                <div class="value">üé® WebGL: ${hasWebGL ? '‚úÖ YES' : '‚ùå NO'}</div>
                <div class="value">üìê Screen: ${window.innerWidth}x${window.innerHeight}</div>
            `;

            document.getElementById('device-info').innerHTML = info;

            console.log('Device Info:', {
                isMobile,
                isWebView,
                memory,
                cores,
                effectiveType,
                hasWebGL,
                screen: `${window.innerWidth}x${window.innerHeight}`
            });
        }

        function checkStorage() {
            const keys = [
                'bullmoney_device_spline_enabled',
                'bullmoney_device_spline_pref_v2',
                'bullmoney_device_perf_choice',
                'bullmoney_device_mobile_spline_opt_in',
                'spline_enabled',
                'perf_choice'
            ];

            let html = '';
            const values = {};

            keys.forEach(key => {
                const value = localStorage.getItem(key);
                values[key] = value;
                const color = value === null ? 'warning' : 'success';
                html += `<div class="value ${color}">üîë ${key}: ${value || 'NOT SET'}</div>`;
            });

            // Show ALL localStorage items
            html += '<div style="margin-top: 15px;" class="label">All LocalStorage:</div>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                if (key.includes('bullmoney') || key.includes('spline')) {
                    html += `<div class="value">üì¶ ${key}: ${value}</div>`;
                }
            }

            document.getElementById('storage-info').innerHTML = html;

            console.log('Storage Values:', values);
            console.log('All BullMoney Storage:', Object.keys(localStorage).filter(k => k.includes('bullmoney') || k.includes('spline')));
        }

        function checkSplineStatus() {
            // Parse the smart storage format
            const rawSplineEnabled = localStorage.getItem('bullmoney_device_spline_enabled');

            let isEnabled = null;
            let html = '';

            if (rawSplineEnabled) {
                try {
                    const data = JSON.parse(rawSplineEnabled);
                    const value = JSON.parse(data.value);
                    isEnabled = value === true || value === 'true';

                    html += `<div class="value ${isEnabled ? 'success' : 'error'}">
                        ${isEnabled ? '‚úÖ SPLINES ENABLED' : '‚ùå SPLINES DISABLED'}
                    </div>`;
                    html += `<div class="value">Raw value: ${data.value}</div>`;
                    html += `<div class="value">Timestamp: ${new Date(data.timestamp).toLocaleString()}</div>`;
                    if (data.expires) {
                        html += `<div class="value">Expires: ${new Date(data.expires).toLocaleString()}</div>`;
                    }
                } catch (e) {
                    // Old format (direct string)
                    isEnabled = rawSplineEnabled === 'true';
                    html += `<div class="value ${isEnabled ? 'success' : 'error'}">
                        ${isEnabled ? '‚úÖ SPLINES ENABLED (old format)' : '‚ùå SPLINES DISABLED (old format)'}
                    </div>`;
                    html += `<div class="value">Raw value: ${rawSplineEnabled}</div>`;
                }
            } else {
                html += '<div class="value warning">‚ö†Ô∏è NOT SET (should default to ENABLED)</div>';
                isEnabled = true; // Default
            }

            document.getElementById('spline-status').innerHTML = html;

            console.log('Spline Status:', {
                rawValue: rawSplineEnabled,
                isEnabled,
                shouldBeEnabled: true
            });
        }

        function enableSplines() {
            console.log('üü¢ Enabling splines...');

            // Set new format (SmartStorage)
            const data = {
                value: 'true',
                timestamp: Date.now(),
                expires: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30 days
            };
            localStorage.setItem('bullmoney_device_spline_enabled', JSON.stringify(data));
            localStorage.setItem('bullmoney_device_spline_pref_v2', JSON.stringify({ value: 'true', timestamp: Date.now() }));

            console.log('‚úÖ Splines enabled!');
            alert('‚úÖ SPLINES ENABLED!\n\nRefresh the main page to see 3D content.');

            checkStorage();
            checkSplineStatus();
        }

        function disableSplines() {
            console.log('üî¥ Disabling splines...');

            const data = {
                value: 'false',
                timestamp: Date.now(),
                expires: Date.now() + (30 * 24 * 60 * 60 * 1000)
            };
            localStorage.setItem('bullmoney_device_spline_enabled', JSON.stringify(data));

            console.log('‚ùå Splines disabled!');
            alert('‚ùå SPLINES DISABLED\n\nRefresh to see speed mode.');

            checkStorage();
            checkSplineStatus();
        }

        function clearAll() {
            if (confirm('‚ö†Ô∏è This will clear ALL BullMoney storage. Continue?')) {
                console.log('üóëÔ∏è Clearing all storage...');

                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.includes('bullmoney') || key.includes('spline')) {
                        localStorage.removeItem(key);
                        console.log('Removed:', key);
                    }
                });

                console.log('‚úÖ Storage cleared!');
                alert('‚úÖ STORAGE CLEARED!\n\nRefresh to start fresh.');

                checkStorage();
                checkSplineStatus();
            }
        }

        // Run checks on load
        console.log('=== SPLINE DEBUG TOOL LOADED ===');
        detectDevice();
        checkStorage();
        checkSplineStatus();
        console.log('=================================');
    </script>
</body>
</html>
